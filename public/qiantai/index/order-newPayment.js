define("member:app/script/page/order-newPayment",function(require,exports,module){function loadDataList(){if(isSupportHistory()){category&&currentPage?loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback,currentPage):!category&&currentPage?loadObj(_dataFn(-1).allUrl,_dataFn(-1).tpl,callback,currentPage):category&&!currentPage?loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback):category||currentPage||loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback);for(var r=$(".type-tab-btn a"),e=Array.prototype.slice.call(r),a=0,n=e.length;n>a;a++)$(e[a]).attr("data-type")==category&&($(".type-tab-btn a").removeClass("active"),$(e[a]).addClass("active"))}else loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback)}function isSupportHistory(){return!(!window.history||!history.pushState)}require("member:app/script/module/handlebars-helper-newPayment");var $=require("common:lib/jquery/jquery-1.11.3"),Cookie=require("member:app/script/module/cookie"),configUrl=require("member:app/script/module/config-url"),loadData=require("member:app/script/module/load-data"),parameter=require("member:app/script/module/href-parameter"),opreatFn=require("member:app/script/page/orderOpreat-newPayment"),ajaxAgency=require("member:app/script/module/isToken"),dailog=require("member:app/script/module/dialog"),Dailog=new dailog("alert"),DailogConfirm=new dailog("confirm"),category=parameter.get("type")||-1,currentPage=parameter.get("current")||1,userId=JSON.parse(decodeURIComponent(Cookie.getCookie("MEIZUSTORESESSIONVAL"))).uid,pageId=$("#pageId").val(),loadObj=function(r,e,a,n){new loadData({url:r,container:"#tableList",tpl:e,noListStr:"您暂无此类订单，赶快去下单吧！",sendData:{pageSize:6,current:n},dataEdit:!0,dataCallBack:dataCallBack,pageType:"default",tplFn:null,callback:a})},orderStatus=-1,orderSn,_dataFn=function(r){var e={allUrl:configUrl+"/vip/order/orders/"+userId+"/"+r,addressUrl:configUrl+"/vip/order/address/"+userId+"/"+orderSn,tpl:'<input id="unPayNum" type="hidden" value="{{data.unPayNum}}">\r\n<table class="orderItem">\r\n    {{#each data.resultList}}\r\n    {{#if old}}\r\n    <tr class="trHead">\r\n        <td colspan="5" class="title">\r\n            下单时间：<span class="time">{{transFormatDateAll createTime}}</span>订单号：<span class="orderNumber">{{orderSn}}</span>\r\n        </td>\r\n    </tr>\r\n    <tr class="list-box b-l b-r b-b">\r\n        <td class="list b-r">\r\n        {{#each childOrders}}\r\n            <div class="item clearfix">\r\n                {{{toSeeProductDetail ../old insuranceOrder itemNumber}}}\r\n                <img src="{{imgUrl}}"></a>\r\n                <div class="describe f-fl">\r\n                    <div class="vertic">\r\n                        <span class="clearfix">\r\n                            {{{toSeeProductDetail ../old insuranceOrder itemNumber}}}\r\n                            {{itemName}}</a>\r\n                            <i class="f-fr">￥{{price}} ×{{quantity}}</i>\r\n                        </span>\r\n                        {{#if insurance}}\r\n                        <span class="clearfix">\r\n                            <i class="f-fl nameWidth">{{insurance.name}}</i>\r\n                            <i class="f-fr">￥{{insurance.price}} ×{{insurance.num}}</i>\r\n                        </span>\r\n                        {{/if}}\r\n                    </div>\r\n                </div>\r\n                <div class="seeDeliverBox">\r\n                    {{{isInsuranceOrder insuranceOrder ../status ../old expressStatus ../../../data.date expressSignDate afterServiceStatus ../orderSn afterService refundType}}}\r\n                    {{!是否是老商品}}\r\n                    <input class="isOldProduct" type="hidden" value="{{../old}}">\r\n                    <input class="orderSn" type="hidden" value="{{../orderSn}}">\r\n                    <input class="orderSnSon" type="hidden" value="{{orderSn}}">\r\n                    <div class="content"></div>\r\n                </div> \r\n            </div>\r\n        {{/each}}\r\n        </td>  \r\n        <td class="b-r w125 center price">\r\n            <div class="priceDiv">\r\n                ￥ {{payPrice}}\r\n                {{{repoOrder repoMoney}}}\r\n                {{{mOrder type}}}\r\n            </div>\r\n        </td>  \r\n        <td class="b-r w125 center state">\r\n            <div class="stateDiv">\r\n                {{orderStatus status}}<br>{{isRefund inServiceStatus}}\r\n            </div>\r\n        </td> \r\n        <td class="w125 center opreat">\r\n            <ul>\r\n                {{!是否是老的商品}}\r\n                    <input class="_isOld" type="hidden" value="{{old}}">\r\n                {{!待付款}}\r\n                {{#equal status 0}}\r\n                    <li class="goPay">{{{goPay orderSn old}}}</li>\r\n                    <li class="cancel">取消订单</li>\r\n                {{/equal}}\r\n                {{!待发货}}\r\n                {{#equal status 1}}\r\n                    {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!意外保订单}}\r\n                {{#equal status 9}}\r\n                    {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!已付款}}\r\n                {{#equal status 11}}\r\n                    {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n            </ul>\r\n        </td> \r\n    </tr>\r\n    <tr class="empty">\r\n        <td></td>\r\n    </tr>\r\n    {{else}}\r\n    <tr class="trHead">\r\n        <td colspan="5" class="title clearfix">\r\n            <div class="f-fl">下单时间：<span class="time">{{transFormatDateAll createTime}}</span>订单号：<span class="orderNumber">{{orderSn}}</span>\r\n            </div>\r\n            <!-- <span class="brand f-fr">\r\n                {{brandName}}\r\n                <i class="service">由“{{brandName}}”负责发货，并提供售后服务</i>\r\n                <i class="icon"></i>\r\n            </span> -->\r\n        </td>\r\n      </tr>\r\n    <tr class="list-box b-l b-r b-b">\r\n        <td class="list b-r">\r\n            {{#orderOptionLenth}}\r\n                {{#each childOrders}}\r\n                    {{#if isMainItem}}\r\n                        <div class="item clearfix">\r\n                            {{{toSeeProductDetail ../../../old ../insuranceOrder ../itemNumber}}}\r\n                            <img src="{{imgUrl}}" class="f-fl"></a>\r\n                            <div class="describe f-fl">\r\n                                <div class="vertic clearfix">\r\n                                    <span class="clearfix">\r\n                                        {{{toSeeProductDetail ../../../old ../insuranceOrder ../itemNumber}}}\r\n                                        {{itemName}} {{packageName}}</a>\r\n                                        <p>￥{{../../../salePrice}} ×{{quantity}}</p>\r\n                                        {{#isDiscount ../../../salePrice ../../../normalPrice}}\r\n                                            <p class="text-gray">￥{{../../../normalPrice}}</p>\r\n                                        {{/isDiscount}}\r\n                                    </span>\r\n                                </div>\r\n                            </div> \r\n                            <div class="seeDeliverBox">\r\n                                {{!是否是意外保订单以及显示是否签收文案}}\r\n                                {{{isInsuranceOrder ../insuranceOrder ../../../status ../../../old expressStatus ../expressSignDate ../expressConfirmTime}}}\r\n                                {{!是否是老商品}}\r\n                                <input class="isOldProduct" type="hidden" value="{{../../old}}">\r\n                                <input class="orderSn" type="hidden" value="{{../../orderSn}}">\r\n                                <input class="orderSnSon" type="hidden" value="{{orderSn}}">\r\n                                <div class="content"></div>\r\n                            </div>\r\n                            {{{serviceEnter expressStatus ../../../../../data.date ../expressSignDate ../../_flag ../../../orderSn ../afterService ../../__refundType ../expressConfirmTime ../../__refundSn ../../flag}}}\r\n                        </div>\r\n                    {{/if}}\r\n                {{/each}}\r\n            {{else}}\r\n                {{#each childOrders}}\r\n                    {{#if package}}\r\n                        <div class="item clearfix">\r\n                            {{{toSeeProductDetail ../../../old ../insuranceOrder ../itemNumber}}}\r\n                            <img src="{{imgUrl}}" class="f-fl"></a>\r\n                            <div class="describe f-fl">\r\n                                <div class="vertic clearfix">\r\n                                    <span class="clearfix">\r\n                                        {{{toSeeProductDetail ../../../old ../insuranceOrder ../itemNumber}}}\r\n                                        {{itemName}} {{packageName}}</a>\r\n                                        <p>￥{{../../../salePrice}} ×{{quantity}}</p>\r\n                                        {{#isDiscount ../../../salePrice ../../../normalPrice}}\r\n                                            <p class="text-gray">￥{{../../../normalPrice}}</p>\r\n                                        {{/isDiscount}}\r\n                                    </span>\r\n                                </div>\r\n                            </div> \r\n                            <div class="seeDeliverBox">\r\n                                {{!是否是意外保订单以及显示是否签收文案}}\r\n                                {{{isInsuranceOrder ../insuranceOrder ../../../status ../../../old expressStatus ../expressSignDate ../expressConfirmTime}}}\r\n                                {{!是否是老商品}}\r\n                                <input class="isOldProduct" type="hidden" value="{{../../old}}">\r\n                                <input class="orderSn" type="hidden" value="{{../../orderSn}}">\r\n                                <input class="orderSnSon" type="hidden" value="{{orderSn}}">\r\n                                <div class="content"></div>\r\n                            </div>\r\n                            {{{serviceEnter expressStatus ../../../../../data.date ../expressSignDate ../../_flag ../../../orderSn ../afterService ../../__refundType ../expressConfirmTime ../../__refundSn ../../flag}}}\r\n                        </div>\r\n                    {{else}}\r\n                        <div class="item clearfix">\r\n                            {{{toSeeProductDetail ../../old insuranceOrder itemNumber}}}\r\n                            <img src="{{imgUrl}}" class="f-fl"></a>\r\n                            <div class="describe f-fl">\r\n                                <div class="vertic clearfix">\r\n                                    <span class="clearfix">\r\n                                        {{{toSeeProductDetail ../../old insuranceOrder itemNumber}}}\r\n                                        {{itemName}} {{packageName}}</a>\r\n                                        <p>￥{{../../../salePrice}} ×{{quantity}}</p>\r\n                                        {{#isDiscount ../../../salePrice ../../../normalPrice}}\r\n                                            <p class="text-gray">￥{{../../../normalPrice}}</p>\r\n                                        {{/isDiscount}}\r\n                                    </span>\r\n                                    {{#if insurance}}\r\n                                    <span class="clearfix">\r\n                                        <i class="f-fl nameWidth">{{insurance.name}}</i>\r\n                                        <i class="f-fr">￥{{insurance.price}} ×{{insurance.num}}</i>\r\n                                    </span>\r\n                                    {{/if}}\r\n                                </div>\r\n                            </div> \r\n                            <div class="seeDeliverBox">\r\n                                {{!是否是意外保订单以及显示是否签收文案}}\r\n                                {{{isInsuranceOrder ../insuranceOrder ../../../status ../../../old expressStatus ../expressSignDate ../expressConfirmTime}}}\r\n                                {{!是否是老商品}}\r\n                                <input class="isOldProduct" type="hidden" value="{{../../old}}">\r\n                                <input class="orderSn" type="hidden" value="{{../../orderSn}}">\r\n                                <input class="orderSnSon" type="hidden" value="{{orderSn}}">\r\n                                <div class="content"></div>\r\n                            </div>\r\n                            {{{serviceEnter expressStatus ../../../../../data.date ../expressSignDate ../../_flag ../../../orderSn ../afterService ../../__refundType ../expressConfirmTime ../../__refundSn ../../flag}}}\r\n                        </div>\r\n                    {{/if}}\r\n                {{/each}}\r\n            {{/orderOptionLenth}}\r\n        </td>   \r\n        <td class="b-r w125 center price">  \r\n            <div class="priceDiv">\r\n                ￥ {{payPrice}}\r\n                {{{mOrder type}}}\r\n                {{#if huabei}}\r\n                    <span class="huabei j-huabei">花呗分期</span>\r\n                    <i class="hb-arr j-hb-item hide"></i>\r\n                    <p class="hb-describ j-hb-item hide">{{huabei}}</p>\r\n                {{/if}}\r\n            </div>\r\n        </td>  \r\n        <td class="b-r w125 center state">\r\n            <div class="stateDiv">\r\n                <div style="margin-bottom:5px">{{orderStatus status}}<br>{{isRefund inServiceStatus}}</div>\r\n                {{{fastArrive fastArriveStatus payTime arriveTime displayArriveInfo status}}}\r\n            </div>\r\n        </td> \r\n        <td class="w125 center opreat">\r\n            <ul>\r\n                {{!待付款}}\r\n                {{#equal status 0}}\r\n                    <li class="goPay">{{{goPay orderSn old}}}</li>\r\n                    <li class="cancel">取消订单</li>\r\n                {{/equal}}\r\n                {{!待发货}}\r\n                {{#equal status 1}}\r\n                    {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!已发货}}\r\n                {{#equal status 2}}\r\n                    <li>{{{receiveFn childOrders}}}</li>\r\n                {{/equal}}\r\n                {{!意外保订单}}\r\n                {{#equal status 9}}\r\n                    {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                {{!已付款}}\r\n                {{#equal status 11}}\r\n                    {{{applyFn inServiceStatus status}}}\r\n                {{/equal}}\r\n                <li class="more">{{{seeDetail orderSn old}}}</li>\r\n            </ul>\r\n        </td> \r\n    </tr>\r\n    <tr class="empty">\r\n        <td></td>\r\n    </tr>\r\n    {{/if}}\r\n    {{/each}}\r\n</table>\r\n'};return e},dataCallBack=function(r){var e=r.data.resultList,a=r.data.unPayNum,n=0,t=0==a?"":a;if($("._actAmount").text(t),e&&!(e.length<=0)){for(var i=0,s=e.length;s>i;i++)for(var l=e[i].childOrders,d=l.length,c=null,o=null,u=null,p=null,v=0,m=d;m>v;v++){var f=l[v].afterService,S=(l[v].isMainItem,l[v].afterServiceStatus),b=l[v].refundSn,g=l[v].refundType;1==l[v].isMainItem&&4!=S?1==f?(u=S,p=g,c=S,o=b):n=0:1==l[v].isMainItem&&4==S?(p=g,c=S,o=b):1!=l[v].isMainItem&&4!=S?1==f&&null==u?(p=g,c=S,o=b):n=0:1!=l[v].isMainItem&&4==S&&null==c&&(p=g,c=S,o=b),f===!0&&n++,n>0&&(e[i].__refundType=p,e[i].__refundSn=o,e[i]._flag=c,e[i].flag=!0)}return r}},callback=function(){$(".brand").hover(function(){var r=$(this),e=r.find(".service"),a=r.find(".icon");e.show(),a.show();var n=(r.width(),a.width()),t=e.width(),i=t+n+25,s=n+4;e.css("margin-left","-"+i+"px"),a.css("margin-left","-"+s+"px")},function(){$(".service").hide(),$(".icon").hide()}),$(".j-huabei,.j-hb-item").hover(function(){$(this).parent().find(".j-hb-item").removeClass("hide")},function(){$(".j-hb-item").addClass("hide")}),$(".seeDeliverBox").hover(function(){var r=$(this),e=r.find(".isOldProduct").val(),a=1==e?r.find(".orderSn").val():r.find(".orderSnSon").val();opreatFn.seeDeliver(r,e,a,pageId,userId)},function(){$(".content").hide()}),$(".cancel").click(function(){var _this=$(this),isOld=eval(_this.parent().find("._isOld").val())===!0?1:0,orderSn=_this.parents(".list-box").find(".orderSn").val(),currentPage=parameter.get("current")||1;opreatFn.cancle(_this,isOld,orderSn,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback,currentPage)})}),$(".apllyBack").click(function(){var _this=$(this),isOld=eval(_this.parent().find("._isOld").val())===!0?1:0,orderSn=_this.parents(".list-box").find(".orderSn").val(),currentPage=parameter.get("current")||1;opreatFn.apllyBack(_this,isOld,orderSn,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback,currentPage)})}),$(".receive").click(function(){var r=$(this),e=r.parents(".list-box").find(".orderSn").val(),a=parameter.get("current")||1;opreatFn.receiveFn(e,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback,a)})}),$(".oreadyGet").click(function(){var r=$(this),e=$(this).attr("data-parentStatus"),a=$(this).parent().parent().find(".describe").find(".productDetail").text(),n=r.parents(".list-box").find(".orderSn").val(),t=r.parent().find(".orderSnSon").val();opreatFn.isGet(r,e,a,n,pageId,t)})};loadDataList(),isSupportHistory()&&$(window).on("popstate",function(){category=parameter.get("type")||-1,currentPage=parameter.get("current")||1,loadDataList()}),$(".type-tab-btn a").click(function(){orderStatus=$(this).attr("data-type"),isSupportHistory()&&history.pushState({title:document.title},document.title,location.href.split("?")[0]+"?type="+orderStatus),$(this).addClass("active").siblings().removeClass("active"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback)})});